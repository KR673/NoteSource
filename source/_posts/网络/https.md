---
title: https
tags: 
  - https
  - 网络
categories:
  - 网络
---

[toc]

一个简易的传输过程:

![](www)

* C: 客户端
* S: 服务端
* cpk: CA机构公钥
* csp: CA机构私钥
* spk: 服务端公钥
* ssk: 服务端私钥

## 1. 具体的流程:

1. 客户端向服务器传输客户端的SSL协议版本号，支持的加密算法的种类，产生的**随机数Key1**及其他信息
2. 服务端确认双方使用的加密方法，同时产生**随机数Key2**，将其和证书一同发送给客户端
3. 客户端验证服务器的合法性，
   * 证书是否过期，
   * 发行服务器证书的CA是否可靠，
   * 发行者的公钥能否正确解开服务器证书的”发行者的数字签名”，
   * 服务器证书上的域名是否和服务的实际域名相匹配，
      1. 如果合法性验证没有通过，通信将断开，
      2. 如果合法性验证通过，将继续向下进行；
4. 客户端随机产生一个**Pre-Master-Key**，然后用服务器的公钥(从证书中获得)对其加密，然后将该Pre-Master-Key发送给服务器
5. 服务器接收到Pre-Master-Key，则使用协商好的算法(H)计算出真正的用户通信过程中使用的对称加密**密钥Master-Key(对话密钥)**=H(随机数Key1+随机数Key2+PreMaster);
6. 至此为止，服务器和客户端之间都得到Master-Key，之后的通信过程就使用Master-Key作为对称加密的密钥进行安全通信

## 2. 相关概念

* **对称加密**: **只有一个密钥**, 加密解密都用它
* **非对称加密**: **有两个不同的密钥**, 公钥和私钥. 公钥加密私钥解密, 私钥加密公钥解密
* **http**: 超文本传输协议,是一个基于请求与响应，无状态的，应用层的协议,**使用明文数据传输的网络协**议,设计HTTP的初衷是为了提供一种发布和接收HTML页面的方法。
* **https**: 基于HTTP协议，**通过SSL或TLS提供数据的加密处理**、验证对方身份以及保护数据完整性
* **CA**: 证书颁发机构（CA, Certificate Authority）即颁发数字证书的机构,电子商务交易中受信任的第三方
* **数字证书**: CA机构通过服务器端发来的信息形成的一个证书信息, 其中包含信息如下:
![](https://mynoteimg.oss-cn-beijing.aliyuncs.com/20191117000430.png)

## 3. 几个问题

### 3.1 客户端如何验证服务器证书的合法性?

### 3.2 可以防止中间人攻击吗?

第3个随机数需要使用服务端的私钥获取, 所以一般的中间人方法不行.但也有其他的途径

## 参考:

1. [漫画：什么是 HTTPS 协议？](https://zhuanlan.zhihu.com/p/57142784)
2. [HTTPS原理全解析](https://www.bilibili.com/video/av66187268)
3. [https服务的原理和实现](https://segmentfault.com/a/1190000014835279?utm_source=tag-newest)
4. [3分钟告诉你什么是 非对称加密、对称加密、公钥、私钥、数字证书、数字签名、信息摘要、中间人攻击、CA、根证书](https://blog.csdn.net/weixin_33932129/article/details/91418397)
5. [Https协议简析及中间人攻击原理](https://www.cnblogs.com/gordon0918/p/5237717.html)
6. [HTTPS 可能被这样劫持吗？](https://www.zhihu.com/question/22795329)